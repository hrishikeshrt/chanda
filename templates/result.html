{% if data.result %}
{% if data.result.line or data.result.verse %}
<hr>
<div class="pb-3">
    Results
    <button id="download-json" class="btn btn-secondary float-right" title="Download Results JSON">
        <i class="fa fa-download"></i>
    </button>
    <button id="download-txt" class="coming-soon btn btn-secondary float-right mx-1" title="Download Results TXT">
        <i class="fas fa-file-lines"></i>
    </button>
    <button class="work-in-progress btn btn-secondary float-right" title="View Summary" data-toggle="modal" data-target="#result-summary-modal">
        <i class="fas fa-chart-simple"></i>
    </button>
</div>
<script>
    $('.work-in-progress').click(function() {
        $.notify({
            message: "The feature is still work in progress."
        }, {
            type: "warning"
        });
    });
    $('.coming-soon').click(function() {
        $.notify({
            message: "The feature will be enabled soon."
        }, {
            type: "danger"
        });
    });
    $("#download-json").click(function(e) {
        e.preventDefault();
        const tmp_link = document.createElement('a');
        document.body.appendChild(tmp_link);
        tmp_link.href = "{{url_for('download_result', filename=data.result_path)}}";
        tmp_link.download = "{{data.result_path}}";
        tmp_link.click();
        tmp_link.remove();
    });
</script>

{% endif %}
{% if data.text_mode == "verse" %}
    {% for verse_result in data.result.verse %}
    {% set verse_loop = loop %}
    {% set verse_id = verse_loop.index %}
    {% set output_scheme = data.output_scheme or verse_result.scheme %}
    <div class="card mb-1">
        <div class="card-header">
            {{verse_id}}. {{" / ".join(verse_result['chanda'][0]) | transliterate(output_scheme)}}
            <button data-toggle="collapse" data-target=".multi-collapse-{{verse_id}}" aria-controls="verse-lines-{{verse_id}} verse-scansion-{{verse_id}}" data-custom-multi-toggle-text="Hide Scansion" data-custom-default-class="btn-info" data-custom-multi-toggle-class="btn-secondary" class="btn btn-sm float-right">Show Scansion</button>
        </div>
        <div id="verse-lines-{{verse_id}}" class="card-body collapse show multi-collapse-{{verse_id}}">
            {% for line_idx in verse_result['lines'] %}
            {% set line_answer = data.result.line[line_idx] %}
            {% set line_text = line_answer.line %}
            {{line_text | transliterate(output_scheme)}}
            <br>
            {% endfor %}
        </div>
        <div id="verse-scansion-{{verse_id}}" class="card-body p-0 m-0 collapse multi-collapse-{{verse_id}}">
            {% for line_idx in verse_result['lines'] %}
                {% set line_answer = data.result.line[line_idx] %}
                {% set line_text = line_answer.line %}
                {% set line_id = loop.index %}
                {% set line_result = line_answer.result %}
                {% include "line_result.html" %}
            {% endfor %}
        </div>
    </div>
    {% endfor %}
{% endif %}
{% if data.text_mode == "line" %}
    {% for line_answer in data.result.line %}
        {% set line_text = line_answer.line %}
        {% set line_id = loop.index %}
        {% set line_result = line_answer.result %}
        {% include "line_result.html" %}
    {% endfor %}
{% endif %}
{% include "result_summary.html" %}
{% endif %}